diff --git a/dbinc/atomic.h b/db4.8/dbinc/atomic.h
index 0034dcc..82c2d5c 100644
--- a/dbinc/atomic.h
+++ b/dbinc/atomic.h
@@ -176,6 +176,7 @@ static inline int __atomic_dec(db_atomic_t *p)
  * http://gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html
  * which configure could be changed to use.
  */
+#if !__has_builtin(__atomic_compare_exchange)
 static inline int __atomic_compare_exchange(
 	db_atomic_t *p, atomic_value_t oldval, atomic_value_t newval)
 {
@@ -190,6 +191,7 @@ static inline int __atomic_compare_exchange(
 	return (was == oldval);
 }
 #endif
+#endif
 
 #else
 /*
